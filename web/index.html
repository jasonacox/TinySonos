<!DOCTYPE html>
<!--
TinySonos - Sonos Jukebox and Controller

Web Based Control Panel and Jukebox for Sonos WiFi Speaker System. This provides
ability to control and play audio files from a localhost/server on a Sonos system,
including multiple audio file formats and m3u playlist.

Author: Jason A. Cox
Date: November 23, 2022
For more information see https://github.com/jasonacox/tinysonos

Credits:
* This Player UI code based on the great work by Annie Wu, 
  https://github.com/anniedotexe/music-player with custom SVG Paths 
  created at https://yqnn.github.io/svg-path-editor/ 

-->
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>TinySonos API Server</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
    // Globals
    var lastnumq = 0;  // last number of songs in queue
    var lastzone = 0;  // last speaker zone used

    // Fast and simple DOM update
    function _updateHTML(element, html) {
        var e = document.querySelector(element);
        e.innerHTML = html;
    }
    function _updateVAL(element, val) {
        var e = document.querySelector(element);
        e.value = val;
    }

    // Get Version
    function showversion() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/stats";
        $.getJSON(pwurl, function(data) {
            var text = `TinySonos Server v${data.tinysonos} [soco v${data.soco}]`;
            $(".sonostitle").html(text);
        });
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/sonos";
        $.getJSON(pwurl, function(data) {
            var text = `Sonos: ${data.household_id} ${data.uid}`;
            $(".sonos").html(text);
        });
        setTimeout(showversion, 60000);
    }

    // Get Current Playing
    function showprogress() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/location";
        $.getJSON(pwurl, function(data) {
            // current location and duration
            document.querySelector("#current-time").innerHTML = data.position;
            document.querySelector("#duration").innerHTML = data.duration;
            // seek slider bar
            console.log(data.position)
            var a = data.position.split(':'); 
            var a1 = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]); 
            var b = data.duration.split(':'); 
            var b1 = (+b[0]) * 60 * 60 + (+b[1]) * 60 + (+b[2]); 
            document.querySelector("#seek-slider").value = 100 * a1/b1;
        }); 
    }

    // Get Current Playing
    function showplaying() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/current";
        $.getJSON(pwurl, function(data) {
            //var text = `${data.state}: ${data.title} - ${data.artist} - ${data.album} - ${data.position}/${data.duration} ` 
            document.querySelector(".title").innerHTML = data.title;
            document.querySelector(".artist").innerHTML = data.artist;
            document.querySelector(".album").innerHTML = data.album;
            document.querySelector("#current-time").innerHTML = data.position;
            document.querySelector("#duration").innerHTML = data.duration;

            // pull title from XML metadata if not existing
            xml = $.parseXML(data.metadata)
            var xmltitle = xml.getElementsByTagName("dc:title")[0];
            if (data.title=='') {
                document.querySelector(".title").innerHTML = xmltitle.childNodes[0].nodeValue;
            }

            // seek slider bar
            var a = data.position.split(':'); 
            var a1 = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]); 
            var b = data.duration.split(':'); 
            var b1 = (+b[0]) * 60 * 60 + (+b[1]) * 60 + (+b[2]); 
            document.querySelector("#seek-slider").value = 100 * a1/b1;

            // album art
            if(data.album_art2) {
                    if($("#album_art").attr("src")!=data.album_art2) {
                        document.querySelector('#album_art').setAttribute('src', data.album_art2);
                        // document.body.style.backgroundImage = "url(" + data.album_art2 + ")";
                        var styleElem = document.head.appendChild(document.createElement("style"));
                        styleElem.innerHTML = "body::before {background: url(" + data.album_art2 + ");}";
                    }
                } 
            else {
                if(data.album_art) {
                    if($("#album_art").attr("src")!=data.album_art) {
                        document.querySelector('#album_art').setAttribute('src', data.album_art);
                        //document.body.style.backgroundImage = "url(" + data.album_art + ")";
                        var styleElem = document.head.appendChild(document.createElement("style"));
                        styleElem.innerHTML = "body::before {background: url(" + data.album_art + ");}";
                    }
                }
                else {
                    if($("#album_art").attr("src")!='/notitle.png') {
                        document.querySelector('#album_art').setAttribute('src', '/notitle.png');
                        //document.body.style.backgroundImage = "url(/notitle.png)";
                        var styleElem = document.head.appendChild(document.createElement("style"));
                        styleElem.innerHTML = "body::before {background: url(/notitle.png);}";
                    }
                }
            }
        }); 
    }

    // Progress Bar Refresh
    function refreshprogress() {
        showprogress();
        setTimeout(refreshprogress, 500);
    }

    // Things to Refresh every 1s
    function refresh1s() {
        showplaying();
        queuedepth();
        setTimeout(refresh1s, 1000);
    }

    // Things to Refresh every 5s
    function refresh5s() {
        showstates();
        setTimeout(refresh5s, 5000);
    }

    // Things to Refresh every 10s
    function refresh10s() {
        updatevolume();
        setTimeout(refresh10s, 10000);
    }

    // Get States
    function showstates() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/state";
        $.getJSON(pwurl, function(data) {
            // play button
            if(data.state == "PLAYING" || data.state=="TRANSITIONING") {
                document.getElementById("play").classList='play-pause active';
                document.getElementById("pause").classList='play-pause';
                document.getElementById("stop").classList='play-pause';
            }
            if(data.state == "PAUSED_PLAYBACK") {
                document.getElementById("play").classList='play-pause';
                document.getElementById("pause").classList='play-pause active';
                document.getElementById("stop").classList='play-pause';
            }
            if(data.state == "STOPPED") {
                document.getElementById("play").classList='play-pause';
                document.getElementById("pause").classList='play-pause';
                document.getElementById("stop").classList='play-pause active';
            }
            // toggles
            if(data.shuffle) {
                document.querySelector(".shuffleT").innerHTML = "YES";
                document.getElementById("shuffle").classList='active';
            } else {
                document.querySelector(".shuffleT").innerHTML = "NO";
                document.getElementById("shuffle").classList='';
            }
            if(data.repeat) {
                document.querySelector(".repeatT").innerHTML = "YES"
                document.getElementById("repeat").classList='active';
            } else {
                document.querySelector(".repeatT").innerHTML = "NO";
                document.getElementById("repeat").classList='';
            }
            lastzone = data.zone;
            var text = `${data.zone}`;
            // document.querySelector(".volume").innerHTML = data.volume;
            
            document.getElementById('volume').textContent = data.volume;
            document.getElementById('volume-slider').value = data.volume;
            
        });
    }

    // Update Volume UI
    function updatevolumeold() {
        // Speaker and volume update
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/speakers";
        $.getJSON(pwurl, function(data) {
            var text = ``;
            var coord = ' ';
            for (let x in data) {
                if(data[x].coordinator) {
                    coord = '*';
                }
                else {
                    coord = ' ';
                }
                var joined = " [ ]";
                if(data[x].state) {
                    joined = " [X]"
                }
                var addr = '"' + data[x].ip + '"';
                text = text + "<li><a href=\"#\" onclick=\"javascript:myclick('setzone/" + data[x].ip + "');\">" + 
                    x + joined + coord + "</a>" + " - Volume: [<a href=\"#\"s onclick='updateVolume1(0," + addr + ")'> Mute </a>]" + 
                    "<label for='volume-slider-" + data[x].ip + "'>" + "</label>" +
                    "<input type='range' id='volume-slider-" + data[x].ip + "'' class='vol-slider' min='0' max='50' value='" + data[x].volume + "' step='1' oninput='updateVolumeDisplay1(this.value," + addr + ")' onchange='updateVolume1(this.value," + addr + ")'>" +
                    "<span id='volume-" + data[x].ip + "'>" + data[x].volume + "</span>" +
                    "</li>";
                // text = text + "<li><a href=\"#\" onclick=\"javascript:myclick('setzone/" + data[x].ip + "');\">" + 
                //     x + joined + coord + "</a>" + " - Volume: " + data[x].volume +
                //     " [<a href=\"#\" onclick=\"javascript:myclick('speaker_vol/" + data[x].ip + "/up');\"> Up+ </a>]" +
                //     " [<a href=\"#\" onclick=\"javascript:myclick('speaker_vol/" + data[x].ip + "/down');\"> Down- </a>]" +
                //     "</li>";
            }
            text = text + "\n"
            document.querySelector(".speakers").innerHTML = text;
        });
    }

    // Update Volume UI
    function updatevolume() {
    // Speaker and volume update
    var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/speakers";
    $.getJSON(pwurl, function(data) {
        var table = "<table style='margin-left: 10px;'>";
        for (let x in data) {
            var coord = data[x].coordinator ? '*' : ' ';
            var joined = data[x].state ? "[X]" : "[ ]";
            var addr = '"' + data[x].ip + '"';

            table += "<tr>";
            table += "<td><a href=\"#\" onclick=\"javascript:myclick('setzone/" + data[x].ip + "');\">" + x + "</a></td>";
            table += "<td>" + joined + "</td>";
            table += "<td>" + coord + "</td>";
            table += "<td>Volume:</td>";
            table += "<td><a href=\"#\" onclick='updateVolume1(0," + addr + ")'>Mute</a></td>";
            table += "<td><label for='volume-slider-" + data[x].ip + "'></label></td>";
            table += "<td><input type='range' id='volume-slider-" + data[x].ip + "' class='vol-slider' min='0' max='50' value='" + data[x].volume + "' step='1' oninput='updateVolumeDisplay1(this.value," + addr + ")' onchange='updateVolume1(this.value," + addr + ")'></td>";
            table += "<td><span id='volume-" + data[x].ip + "'>" + data[x].volume + "</span></td>";
            table += "<td><button onclick='updateVolumeclick(+1," + addr + ")'>Up</button></td>"; // Up button
            table += "<td><button onclick='updateVolumeclick(-1," + addr + ")'>Down</button></td>"; // Down button
            table += "</tr>";
        }
        table += "</table>";

        document.querySelector(".speakers").innerHTML = table;
    });
}


    // Clear bold items in menu
    function clearmenu() {
        document.getElementById("playlists").style.fontWeight = "normal";
        document.getElementById("recent").style.fontWeight = "normal";
        document.getElementById("albums").style.fontWeight = "normal";
        document.getElementById("artists").style.fontWeight = "normal";
        document.getElementById("songs").style.fontWeight = "normal";
        document.getElementById("search").style.fontWeight = "normal";
    }
    // Playlists 
    function showplaylists() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/listm3u";
        $.getJSON(pwurl, function(data) {
            // store entire array 
            let fn = "";
            let name = "";
            let output = "";
            let total = 0;
            let rownum = 1;
            let playlists = data.sort() //(c1, c2) => (c1 > c2) ? 1 : (c1 < c2) ? -1 : 0);
            // 
            for (let x in playlists) {
                output = output + "<li>" + 
                    "<a href=\"#\" onclick=\"javascript:myclick('playlist/" +
                    encodeURI(playlists[x]) + "');\">" + 
                    playlists[x] + "</a></li>\n";
                    
                rownum++;
            }
            
            document.querySelector(".menutitle").innerHTML = "Playlists";
            document.querySelector(".menunumber").innerHTML = rownum-1;
            document.querySelector(".menucontent").innerHTML = output;
            clearmenu();
            document.getElementById("playlists").style.fontWeight = "bold";
            
        });
        // setTimeout(showplaylists, 5000);
    }

    // Queue List
    function queuelist() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/playing";
        var output = "";
        $.getJSON(pwurl, function(data) {
            if(data.length) {
                var length = new Date(data.length * 1000).toISOString().substring(14, 19)
                output = "<b>" + data.title +
                        " - " + data.album + " - " + data.artist + " [" + 
                        length + "]</b><br>\n";
            }
        });
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/queue";
        $.getJSON(pwurl, function(data) {
            let rownum = 1;
            for (let x in data) {
                let length = new Date(data[x].length * 1000).toISOString().substring(14, 19)
                output = output + rownum + " - " + data[x].title +
                    " - " + data[x].album + " - " + data[x].artist + " [" + 
                    length + "]<br>\n";
                rownum++;
            }
            document.querySelector(".queue").innerHTML = output;
            document.querySelector(".queuedepth").innerHTML = rownum-1;
        });
    }

    // Number of Songs in Queue - do we update list?
    function queuedepth() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/queuedepth";
        $.getJSON(pwurl, function(data) {
            if(data.queuedepth != lastnumq) {
                lastnumq = data.queuedepth;
                setTimeout(showplaying, 500);
                queuelist();
            }
        });
    }

    // Highlight element
    function highlight(element) {
        let defaultBG = element.style.backgroundColor;
        let defaultTransition = element.style.transition;

        element.style.transition = "background 1s";
        element.style.backgroundColor = "#FF47";

        setTimeout(function()
        {
            element.style.backgroundColor = defaultBG;
            setTimeout(function() {
                element.style.transition = defaultTransition;
            }, 1000);
        }, 1000);
    }

    // Alert
    function removeNotification() {
        $(".alert").hide(100);
    }

    function displayNotification(notification) {
        $(".alert").show(100);
        $(".alerttext").html(notification);
        setTimeout(() => {
            removeNotification();
        }, 2000);
    }

    // Click On
    function myclick(link) {
        var clickurl = window.location.protocol + "//" + window.location.hostname + ":8001/" + link;
        console.log(clickurl)
        $.get(clickurl, function(data) {
            displayNotification("Response: " + data.Response)
        });   
        setTimeout(showstates, 100);
        setTimeout(showplaying, 100);
    }

    // Toggle play button
    function playtoggle() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/state";
        $.getJSON(pwurl, function(data) {
            var current = data.state;
            var link = "";
            if (current=="PLAYING") {
                link = "pause"
                document.getElementById("play").classList='play-pause';
                document.getElementById("stop").classList='play-pause';
                document.getElementById("pause").classList='play-pause active';
            }
            else {
                link = "play"
                document.getElementById("pause").classList='play-pause';
                document.getElementById("stop").classList='play-pause';
                document.getElementById("play").classList='play-pause active';
            }
            var clickurl = window.location.protocol + "//" + window.location.hostname + ":8001/" + link;
            $.get(clickurl, function(data) {
                //displayNotification("Response: " + data.Response)
            });  
        });
        setTimeout(showstates, 1000);
        setTimeout(showplaying, 500);
    }
    
    // Show Recent Albums 
    function showrecent() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/albums/recent";
        var thumbbase = window.location.protocol + "//" + window.location.hostname;
        var rownum = 1;
        var thumb = "";
        $.getJSON(pwurl, function(data) {
            // array of albums
            var output = "";
            for (let x in data) {
                /*
                output = output + "<li>" + 
                    "<a href=\"#\" onclick=\"javascript:myclick('albumadd/" +
                    encodeURI(data[x].key) + "');\">" + 
                    data[x].title + " - " + data[x].artist + "</a></li>\n";
                */
                if(data[x].thumbfile) 
                    thumb = thumbbase + ":54000" + data[x].thumbfile
                else
                    thumb = thumbbase + ":8001/notitle.png"
                output = output + 
                    "<div class='albumrow'>" +
                        "<div class='albumthumb'>" +
                            "<img style='vertical-align:middle;' height=45 width=45 style=\"albumthumb\" src=\"" + thumb + "\">" +
                        "</div>" +
                        "<div class='albumdetail'>" +
                            "<div class='songline'>" + data[x].title + " - " + data[x].artist + "</div>" +
                            "<div>" +
                                "<button onclick=\"javascript:myclick('albumadd/" + encodeURI(data[x].key) +  "');\">Add All " + data[x].songs + " Songs</button> " + 
                                "<button onclick=\"javascript:expandalbum('" + data[x].key + "');\">View Songs</button>" + 
                            "</div> " +
                            "<div class='songlist, songs" + data[x].key + "'>" + 
                            "</div>" +
                        "</div>" +
                    "</div>\n";
                rownum++;
            }
            document.querySelector(".menutitle").innerHTML = "Recently Added Albums";
            document.querySelector(".menunumber").innerHTML = rownum-1;
            document.querySelector(".menucontent").innerHTML = output;
            clearmenu();
            document.getElementById("recent").style.fontWeight = "bold";
        });
    }

    function expandalbum(key) {
        var id = ".songs" + key;
        if (document.querySelector(id).innerHTML == "") {
            var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/album/" + key;
            $.getJSON(pwurl, function(data) {
                var songlist = "";
                for (let x in data.tracks) {
                    var length = new Date(data.tracks[x].length * 1000).toISOString().substring(14, 19)
                    songlist = songlist +         
                        "<li><a href='#' onclick=\"javascript:myclick('addsong/" + encodeURI(data.tracks[x].key) +  "');\">" + data.tracks[x].song + " [" + length + "]</a></li>"
                }
                document.querySelector(id).innerHTML = songlist;
            });
        }
        else {
            document.querySelector(id).innerHTML = "";
        }

    }

    function expandalbum2(key, row) {
        var id = ".expand" + row;
        var dataid = ".data" + row;
        var albumid = ".album" + key;
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/album/" + key;
        $.getJSON(pwurl, function(data) {
            var songlist = "<span class=\"atitle\">" + data.title + "</span>" +
                "<span class=\"asubtitle\">" + data.artist + "</span><br>" +
                "<button onclick=\"javascript:myclick('albumadd/" + encodeURI(key) +  "');\">Add All</button><br>"
            for (let x in data.tracks) {
                var length = new Date(data.tracks[x].length * 1000).toISOString().substring(14, 19)
                songlist = songlist +         
                    "<li><a href=\"#\" onclick=\"javascript:myclick('addsong/" + encodeURI(data.tracks[x].key) + 
                            "');\">" + data.tracks[x].song + " [" + length + "]</a></li>";
            }    

            // clear old highlights if set
            var ha = localStorage.getItem('highlight-albumid');
            var hr = localStorage.getItem('highlight-rowid');
            if (ha != albumid && ha != "") {
                // unhighlight old album
                document.querySelector(ha).style.backgroundColor = "";
                document.querySelector(ha).style.height = "";
                document.querySelector(ha).style.marginBottom = "";
                document.querySelector(ha).style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.1)";
            }
            if (hr != id && hr != "") {
                // unhighlight old row
                document.querySelector(hr).style.backgroundColor = "";
                document.querySelector(hr).innerHTML = "";
            }

            //console.log(document.querySelector(albumid).style.borderColor);
            // change content or toggle off if same
            if (ha == albumid) {
                document.querySelector(id).innerHTML = "";
                document.querySelector(id).style.backgroundColor = "";
                document.querySelector(albumid).style.backgroundColor = "";
                document.querySelector(albumid).style.height = "";
                document.querySelector(albumid).style.marginBottom = "";
                document.querySelector(albumid).style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.1)";
                document.querySelector(dataid).innerHTML = "";
                localStorage.setItem('highlight-albumid', "");
                localStorage.setItem('highlight-rowid', "");
            }
            else {
                document.querySelector(id).innerHTML = songlist;
                document.querySelector(albumid).style.backgroundColor = "#FF47";
                document.querySelector(albumid).style.height = "190px";
                document.querySelector(albumid).style.marginBottom = "0px";
                document.querySelector(albumid).style.boxShadow = "0 0 0";
                document.querySelector(id).style.backgroundColor = "#FF47";
                var z = document.querySelector(dataid).innerHTML;
                if (z != "") {
                    document.querySelector(z).style.backgroundColor = "";
                }
                document.querySelector(dataid).innerHTML = albumid;
                localStorage.setItem('highlight-albumid', albumid);
                localStorage.setItem('highlight-rowid', id);
            }
        });
    }

    // Show Albums 
    function showalbums(scope) {
        // var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/albums/all";
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/albums/" + scope;
        var thumbbase = window.location.protocol + "//" + window.location.hostname;
        var thumb = "";
        $.getJSON(pwurl, function(data) {
            // array of albums
            var output = "";
            var col = 0;
            var row = 0;
            // show all album tiles
            for (let x in data) {
                if(data[x].thumbfile) 
                    thumb = thumbbase + ":54000" + data[x].thumbfile
                else
                    thumb = thumbbase + ":8001/notitle.png"
                col += 1;
                if (col == 1) {
                    output = output + "<div class=\"arow rowid" + row.toString() + "\">\n";
                }
                output = output + 
                    "<div class=\"album-card album" + data[x].key+  "\">" +
                        "<div class=\"album-thumb\">" +
                            "<a href=\"#rowid" + row.toString() + "\" onclick=\"javascript:expandalbum2(" +
                                data[x].key + "," + row.toString() + ");\">" +
                                "<img class=\"album-img\" src=\"" + thumb + "\">" +
                            "</a>\n" +
                        "</div>" +
                        "<div class=\"album-text\">" +
                            "<div class=\"atitle\">" +
                                "<a href=\"#rowid" + row.toString() + "\" onclick=\"javascjavascript:expandalbum2(" +
                                data[x].key +  "," + row.toString() + ");\">" + data[x].title + 
                                "</a>\n" +
                            "</div>" +
                            "<div class=\"asubtitle\">" +
                                data[x].artist + "<br>" +
                                "<a href=\"#rowid" + row.toString() + "\" onclick=\"javascript:expandalbum2(" + data[x].key + "," + 
                                    row.toString() + ");\">"  + "[" + data[x].songs + " Songs]" + 
                                "</a>\n" +
                            "</div>" +
                        "</div>" +
                    "</div>\n";

                if (col >= 4) {
                    output = output + "</div>\n" +
                        "<div class=\"album-expand expand" + row.toString() + "\">" + 
                        "</div>" +
                        "<div hidden class =\"data" + row.toString() + "\"></div>";
                    col = 0;
                    row += 1;
                }
            }
            output = output + "</div>\n" +
                "<div class=\"album-expand expand" + row.toString() + "\">" + 
                "</div>" +
                "<div hidden class =\"data" + row.toString() + "\"></div>";
            
            
            document.querySelector(".menunumber").innerHTML = row-1;
            document.querySelector(".menucontent").innerHTML = output;
            clearmenu();
            if (scope == "recent") {
                document.getElementById("recent").style.fontWeight = "bold";
                document.querySelector(".menutitle").innerHTML = "Recent Albums";
            }
            else {
                document.getElementById("albums").style.fontWeight = "bold";
                document.querySelector(".menutitle").innerHTML = "All Albums";
            }

        });
    }

    // Show Songs 
    function showsongs() {
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001/albums/recent";
        var rownum = 1
        $.getJSON(pwurl, function(data) {
            // array of albums
            var output = "";
            for (let x in data) {
                output = output + "<li>" + 
                    "<a href=\"#\" onclick=\"javascript:myclick('albumadd/" +
                    encodeURI(data[x].key) + "');\">" + 
                    data[x].title + "</a></li>\n";
                rownum++;
            }
            document.querySelector(".menutitle").innerHTML = "Songs";
            document.querySelector(".menunumber").innerHTML = rownum-1;
            document.querySelector(".menucontent").innerHTML = output;
            clearmenu();
            document.getElementById("songs").style.fontWeight = "bold";
        });
    }

    // Search 
    function showsearch() {
        var output = "Search TBD";
        document.querySelector(".menutitle").innerHTML = "Search";
        document.querySelector(".menunumber").innerHTML = "TBD"
        document.querySelector(".menucontent").innerHTML = "";
        clearmenu();
        document.getElementById("search").style.fontWeight = "bold";
    }

    // Search 
    function showartists() {
        var output = "TBD";
        document.querySelector(".menutitle").innerHTML = "Artists";
        document.querySelector(".menunumber").innerHTML = "TBD"
        document.querySelector(".menucontent").innerHTML = "";
        clearmenu();
        document.getElementById("artists").style.fontWeight = "bold";
    }

    // Volume Change Handlers
    function updateVolume(value) {
        document.getElementById('volume').textContent = value;

        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001//volume/" + value;
        $.getJSON(pwurl, function(data) {
            console.log(data);
        });
        // Refresh Display
        setTimeout(showstates, 100);
    }
    function updateVolumeDisplay(value) {
        const volumeValue = document.getElementById('volume');
        volumeValue.textContent = value;
    }
    function updateVolume1(value, ip) {
        document.getElementById('volume-' + ip).textContent = value;
        document.getElementById('volume-slider-' + ip).value = value;
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001//speaker_vol/" + ip + "/" + value;
        $.getJSON(pwurl, function(data) {
            console.log(data);
        });
    }
    function updateVolumeDisplay1(value, ip) {
        const volumeValue = document.getElementById('volume-' + ip);
        volumeValue.textContent = value;
    }
    function updateVolumeclick(delta, ip) {
        var newvalue = parseInt(document.getElementById('volume-slider-' + ip).value) + parseInt(delta)
        document.getElementById('volume-' + ip).textContent = newvalue;
        document.getElementById('volume-slider-' + ip).value = newvalue;
        var pwurl = window.location.protocol + "//" + window.location.hostname + ":8001//speaker_vol/" + ip + "/" + newvalue;
        $.getJSON(pwurl, function(data) {
            console.log(data);
        });
    }
    </script>
</head>

<body>
    <div class="row">
        <div class="playercolumn">
            <div class="player-container">
                <div class="player">
                    <div class="album-cover">
                        <img id="album_art" src="notitle.png" alt="album cover">
                    </div>
                    <div class="song-info">
                        <p class="title">Song Title</p>
                        <p class="album">Album Title</p>
                        <p class="artist">Artist Name</p>
                    </div>
                    <div class="song-timeline">
                        <span id="current-time" class="time-stamp">00:00:00</span>
                        <input type="range" id="seek-slider" max="100" value="0">
                        <span id="duration" class="time-stamp">00:00:00</span>
                    </div>
                    <div class="bottom-controls">
                        <div id="repeat"  onclick="javascript:myclick('toggle/repeat');">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M19 10.9089C18.447 10.9089 18 11.3162 18 11.818C18 13.3217 16.654 14.5453 15 14.5453H7V11.818C7 11.4689 6.77902 11.1498 6.43402 10.9989C6.08503 10.848 5.67601 10.8898 5.37501 11.108L0.374989 14.7444C0.137973 14.9172 0 15.1781 0 15.4545C0 15.7308 0.138016 15.9917 0.374989 16.1645L5.37501 19.8009C5.55599 19.9318 5.77703 20 5.99999 20C6.14699 20 6.296 19.97 6.43398 19.91C6.77897 19.7591 6.99996 19.44 6.99996 19.0909V16.3636H15C17.757 16.3636 20 14.3244 20 11.818C20 11.3162 19.553 10.9089 19 10.9089Z"
                                    fill="#808782" />
                                <path
                                    d="M1.00001 9.09071C1.55302 9.09071 2.00003 8.68344 2.00003 8.18159C2.00003 6.67794 3.34602 5.45428 5.00002 5.45428H13V8.18159C13 8.5307 13.221 8.84977 13.566 9.00071C13.705 9.06071 13.853 9.09071 14 9.09071C14.223 9.09071 14.444 9.02255 14.625 8.89161L19.625 5.25518C19.862 5.08244 20 4.82154 20 4.54516C20 4.26879 19.862 4.00789 19.625 3.83515L14.625 0.198722C14.325 -0.0194454 13.911 -0.0612821 13.566 0.0896189C13.221 0.24052 13 0.559627 13 0.908735V3.63605H5.00002C2.24301 3.63605 0 5.67518 0 8.18159C0 8.68344 0.447004 9.09071 1.00001 9.09071Z"
                                    fill="#808782" />
                            </svg>
                        </div>
        
                        <div id="previous" onclick="javascript:myclick('prev');">
                            <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0.999961 0.000776451C1.55194 0.000776451 1.99992 0.448759 1.99992 1.00074V8.29046L16.5094 0.128771C16.8153 -0.0452218 17.1973 -0.0432219 17.5033 0.136771C17.8093 0.316764 17.9993 0.644751 17.9993 1.00074V19C17.9993 19.356 17.8093 19.684 17.5033 19.864C17.3493 19.954 17.1733 20 16.9993 20C16.8293 20 16.6614 19.958 16.5094 19.872L1.99992 11.7103V19C1.99992 19.552 1.55194 20 0.999961 20C0.447983 20 0 19.552 0 19V1.00074C0 0.448759 0.447983 0.000776451 0.999961 0.000776451V0.000776451Z"
                                    fill="#808782" />
                            </svg>
                        </div>
        
                        <div onclick="javascript:playtoggle();">
                            <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Path https://yqnn.github.io/svg-path-editor/ -->
                                <path id="play" class="play-pause active"
                                    d="M25 0C11.1585 0 0 11.1585 0 25C0 38.8415 11.1585 50 25 50C38.8415 50 50 38.8415 50 25C50 11.1585 38.8415 0 25 0ZM36.0976 26.1585L19.4512 35.9146C19.2683 36.0366 18.9634 36.0976 18.7805 36.0976C18.5976 36.0976 18.2927 36.0366 18.1098 35.9146C17.6829 35.6098 17.439 35.2439 17.439 34.7561V15.3049H17.378C17.378 14.8171 17.6829 14.3293 18.0488 14.1463C18.4146 13.9634 19.0244 13.8415 19.4512 14.1463L36.0976 23.8415C36.5244 24.1463 36.7683 24.5122 36.7683 25C36.7683 25.4878 36.4634 25.9756 36.0976 26.1585Z"
                                    fill="#CC7E85" />
                                <path id="pause" class="play-pause"
                                    d="M25 0C11.1875 0 0 11.1875 0 25C0 38.8125 11.1875 50 25 50C38.8125 50 50 38.8125 50 25C50 11.1875 38.8125 0 25 0ZM22.25 31.25C22.25 32.8125 21 34 19.5 34C17.9375 34 16.75 32.75 16.75 31.25V18.75C16.6875 17.25 17.9375 16 19.4375 16C21 16 22.25 17.25 22.25 18.75V31.25ZM33.3125 31.25C33.3125 32.8125 32.0625 34 30.5625 34C29 34 27.8125 32.75 27.8125 31.25V18.75C27.75 17.25 29 16 30.5 16C32.0625 16 33.3125 17.25 33.3125 18.75V31.25Z"
                                    fill="#CC7E85" />
                                <path id="stop" class="play-pause"
                                    d="M25 0C11.1875 0 0 11.1875 0 25 0 38.8125 11.1875 50 25 50 38.8125 50 50 38.8125 50 25 50 11.1875 38.8125 0 25 0ZM15 18C15 16 16 15 18 15L32 15C34 15 35 16 35 18L35 32C35 34 34 35 32 35L18 35C16 35 15 34 15 32Z"
                                    fill="#CC7E85" />
                            </svg>
                        </div>
        
                        <div id="next" onclick="javascript:myclick('next');">
                            <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M17 0C16.448 0 16 0.448 16 1V8.29L1.49 0.128C1.184 -0.044 0.802 -0.042 0.496 0.136C0.19 0.314 0 0.644 0 1V19C0 19.356 0.19 19.684 0.496 19.864C0.65 19.954 0.826 20 1 20C1.17 20 1.338 19.958 1.49 19.872L16 11.71V19C16 19.552 16.448 20 17 20C17.552 20 18 19.552 18 19V1C18 0.448 17.552 0 17 0Z"
                                    fill="#808782" />
                            </svg>
                        </div>
        
                        <div id="shuffle" onclick="javascript:myclick('toggle/shuffle');">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0.83332 5.45423H2.5C3.23332 5.45423 3.95418 5.66423 4.58332 6.06242C4.715 6.14607 4.85914 6.18515 5.00082 6.18515C5.28832 6.18515 5.56832 6.02241 5.7225 5.73242C5.95418 5.29788 5.8175 4.74151 5.42 4.48966C4.53582 3.9315 3.52668 3.63602 2.5 3.63602H0.83332C0.3725 3.63602 0 4.04332 0 4.54515C0 5.04697 0.3725 5.45423 0.83332 5.45423Z"
                                    fill="#808782" />
                                <path
                                    d="M12.5 5.45423H14.1667V8.18153C14.1667 8.53063 14.3509 8.84972 14.6384 9.00062C14.7542 9.06062 14.8775 9.09062 15 9.09062C15.1859 9.09062 15.37 9.02244 15.5209 8.89153L19.6875 5.25514C19.885 5.08242 20 4.8215 20 4.54514C20 4.26879 19.885 4.00786 19.6875 3.83515L15.5208 0.198718C15.27 -0.0194664 14.9258 -0.0612709 14.6383 0.0896256C14.3508 0.240522 14.1666 0.559617 14.1666 0.908711V3.63601H12.5C9.28418 3.63601 6.66668 6.4906 6.66668 9.9997C6.66668 12.5061 4.7975 14.5452 2.5 14.5452H0.83332C0.3725 14.5452 0 14.9525 0 15.4544C0 15.9562 0.3725 16.3634 0.83332 16.3634H2.5C5.71582 16.3634 8.33332 13.5088 8.33332 9.99975C8.33332 7.49336 10.2025 5.45423 12.5 5.45423Z"
                                    fill="#808782" />
                                <path
                                    d="M19.6875 14.7445L15.5208 11.1081C15.27 10.889 14.9258 10.8472 14.6383 10.9981C14.3508 11.15 14.1666 11.4681 14.1666 11.8182V14.5455H12.5C11.6767 14.5455 10.88 14.2836 10.1967 13.7882C9.81167 13.5118 9.29585 13.6236 9.04167 14.0427C8.78667 14.4609 8.89085 15.0254 9.27417 15.3027C10.2317 15.9963 11.3467 16.3636 12.5 16.3636H14.1667V19.0909C14.1667 19.44 14.3509 19.7591 14.6384 19.91C14.7542 19.97 14.8775 20 15 20C15.1859 20 15.37 19.9318 15.5209 19.8009L19.6875 16.1645C19.885 15.9918 20 15.73 20 15.4545C20 15.1781 19.885 14.9163 19.6875 14.7445Z"
                                    fill="#808782" />
                            </svg>
                        </div>
        
                    </div>
                </div>
            </div>
            <div class="queue-container">
                <p class="headings">Songs in Queue [<a href="#" onclick="javascript:myclick('queue/clear');">Clear</a>] - Number: <b class="queuedepth">0</b>
                </p>
                <div class="queue"></div>
                <input type="button" value="Select Song" onclick="window.open('select.html','popUpWindow','height=500,width=400,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');">
            </div>
        </div>
        
        <div class="datacolumn">
            <div class="sonostitle">Sonos</div>
            <div class="system">
                <div id="volume-container">
                    <label for="volume-slider">Speakers - Main Volume [<a href="#" onclick="javascript:myclick('volume/mute');"> Mute </a>]:</label>
                    <input type="range" id="volume-slider" class="vol-slider" min="0" max="50" value="0" step="1" oninput="updateVolumeDisplay(this.value)" onchange="updateVolume(this.value)">
                    <span id="volume">0</span>
                </div>
                <!-- <span>Speaker Volume:</b> <b class="volume">0</b> [<a href="#" onclick="javascript:myclick('volume/up');"> Up+ </a>  
                    / <a href="#" onclick="javascript:myclick('volume/down');"> Down- </a>]</span> -->
                <span class="speakers">Unknown</span>
                <span>Controls: 
                    <li><a href="#" onclick="javascript:myclick('play');">Play</a> 
                        | <a href="#" onclick="javascript:myclick('pause');">Pause</a>  
                        | <a href="#" onclick="javascript:myclick('stop');">Stop</a> 
                        | <a href="#" onclick="javascript:myclick('prev');"><< Prev</a> 
                        | <a href="#" onclick="javascript:myclick('next');">Next >></a> 
                        | <a href="#" onclick="javascript:myclick('toggle/repeat');">Repeat: <b class="repeatT">NO</b></a> 
                        | <a href="#" onclick="javascript:myclick('toggle/shuffle');">Shuffle: <b class="shuffleT">NO</b></a>
                    </li>
                </span>
            </div>
            <div class="menu-container">
                <p class="headings">Song Library</p>
                <div class="menu-row">
                    <div class="menu-left">
                        <p id="playlists"><a href="#" onclick="javascript:showplaylists();">Playlists</a></p>
                        <p id="recent"><a href="#" onclick="javascript:showalbums('recent');">Recent</a></p>
                        <p id="albums"><a href="#" onclick="javascript:showalbums('all');">Albums</a></p>
                        <p id="artists"><a href="#" onclick="javascript:showartists();">Artists</a></p>
                        <p id="songs"><a href="#" onclick="javascript:showsongs();">Songs</a></p>
                        <p id="search"><a href="#" onclick="javascript:showsearch();">Search</a></p>
                    </div>
                    <div class="menu-right">
                        <span class="menuheading"><b class="menutitle">Menu Title</b> <b>[</b><b class="menunumber">0</b><b>]</b></span>
                        <div class="menucontent"></div>
                    </div>
                </div>
            </div>
            <p class="sonos">Sonos: Unknown</p>
        </div>
        
    </div>
    <div class="alert" hidden="true">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        <b class="alerttext">This is an alert</b>
    </div>

    <div hidden="true" class="highlight-albumid">
    </div>
    <div hidden="true" class="highlight-rowid">
    </div>

    <script>

    // Setup local variables
    localStorage.setItem('highlight-albumid', "");
    localStorage.setItem('highlight-rowid', "");
                
    // Display
    showversion();
    showplaylists();
    queuelist();
    queuedepth();
    // Refresh
    refresh1s();
    refresh5s();
    refresh10s();

    
    </script>

</body>
</html>
